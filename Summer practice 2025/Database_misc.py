import sqlite3

def db_fetch_conversion(cursor, currency):
    ticker = 'USD' + currency.upper().strip()
    rate = None
    n = 0
    while not rate:
        rate = cursor.execute(f'SELECT {ticker} FROM currencies WHERE ID = MAX(ID) - {n} AND {ticker} IS NOT NULL')
        n += 1

    return rate


def db_currency_init(cursor):
    cursor.execute('DROP TABLE IF EXISTS currencies')
    cursor.execute('''
    CREATE TABLE currencies(
    ID INTEGER PRIMARY KEY,
    USDAED REAL,
    USDAFN REAL,
    USDALL REAL,
    USDAMD REAL,
    USDANG REAL,
    USDAOA REAL,
    USDARS REAL,
    USDAUD REAL,
    USDAWG REAL,
    USDAZN REAL,
    USDBAM REAL,
    USDBBD REAL,
    USDBDT REAL,
    USDBGN REAL,
    USDBHD REAL,
    USDBIF REAL,
    USDBMD REAL,
    USDBND REAL,
    USDBOB REAL,
    USDBRL REAL,
    USDBSD REAL,
    USDBTC REAL,
    USDBTN REAL,
    USDBWP REAL,
    USDBYN REAL,
    USDBYR REAL,
    USDBZD REAL,
    USDCAD REAL,
    USDCDF REAL,
    USDCHF REAL,
    USDCLF REAL,
    USDCLP REAL,
    USDCNY REAL,
    USDCNH REAL,
    USDCOP REAL,
    USDCRC REAL,
    USDCUC REAL,
    USDCUP REAL,
    USDCVE REAL,
    USDCZK REAL,
    USDDJF REAL,
    USDDKK REAL,
    USDDOP REAL,
    USDDZD REAL,
    USDEGP REAL,
    USDERN REAL,
    USDETB REAL,
    USDEUR REAL,
    USDFJD REAL,
    USDFKP REAL,
    USDGBP REAL,
    USDGEL REAL,
    USDGGP REAL,
    USDGHS REAL,
    USDGIP REAL,
    USDGMD REAL,
    USDGNF REAL,
    USDGTQ REAL,
    USDGYD REAL,
    USDHKD REAL,
    USDHNL REAL,
    USDHRK REAL,
    USDHTG REAL,
    USDHUF REAL,
    USDIDR REAL,
    USDILS REAL,
    USDIMP REAL,
    USDINR REAL,
    USDIQD REAL,
    USDIRR REAL,
    USDISK REAL,
    USDJEP REAL,
    USDJMD REAL,
    USDJOD REAL,
    USDJPY REAL,
    USDKES REAL,
    USDKGS REAL,
    USDKHR REAL,
    USDKMF REAL,
    USDKPW REAL,
    USDKRW REAL,
    USDKWD REAL,
    USDKYD REAL,
    USDKZT REAL,
    USDLAK REAL,
    USDLBP REAL,
    USDLKR REAL,
    USDLRD REAL,
    USDLSL REAL,
    USDLTL REAL,
    USDLVL REAL,
    USDLYD REAL,
    USDMAD REAL,
    USDMDL REAL,
    USDMGA REAL,
    USDMKD REAL,
    USDMMK REAL,
    USDMNT REAL,
    USDMOP REAL,
    USDMRU REAL,
    USDMUR REAL,
    USDMVR REAL,
    USDMWK REAL,
    USDMXN REAL,
    USDMYR REAL,
    USDMZN REAL,
    USDNAD REAL,
    USDNGN REAL,
    USDNIO REAL,
    USDNOK REAL,
    USDNPR REAL,
    USDNZD REAL,
    USDOMR REAL,
    USDPAB REAL,
    USDPEN REAL,
    USDPGK REAL,
    USDPHP REAL,
    USDPKR REAL,
    USDPLN REAL,
    USDPYG REAL,
    USDQAR REAL,
    USDRON REAL,
    USDRSD REAL,
    USDRUB REAL,
    USDRWF REAL,
    USDSAR REAL,
    USDSBD REAL,
    USDSCR REAL,
    USDSDG REAL,
    USDSEK REAL,
    USDSGD REAL,
    USDSHP REAL,
    USDSLE REAL,
    USDSLL REAL,
    USDSOS REAL,
    USDSRD REAL,
    USDSTD REAL,
    USDSVC REAL,
    USDSYP REAL,
    USDSZL REAL,
    USDTHB REAL,
    USDTJS REAL,
    USDTMT REAL,
    USDTND REAL,
    USDTOP REAL,
    USDTRY REAL,
    USDTTD REAL,
    USDTWD REAL,
    USDTZS REAL,
    USDUAH REAL,
    USDUGX REAL,
    USDUYU REAL,
    USDUZS REAL,
    USDVES REAL,
    USDVND REAL,
    USDVUV REAL,
    USDWST REAL,
    USDXAF REAL,
    USDXAG REAL,
    USDXAU REAL,
    USDXCD REAL,
    USDXDR REAL,
    USDXOF REAL,
    USDXPF REAL,
    USDYER REAL,
    USDZAR REAL,
    USDZMK REAL,
    USDZMW REAL,
    USDZWL  REAL
    );
    ''')